<!--
  ~ Aurelien Munoz <munoz.aurelien@gmail.com>
  ~ Twitter : @aurelien_munoz
  ~ LaneSmash Script for PS2 10/2020
  -->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<pre id="debugger"></pre>
<script type="text/javascript">
    const container = document.getElementById("debugger");

    window.addEventListener("load",() => {


        class LaneFacilityState {
            constructor() {
                /**
                 * @var {String}
                 */
                this.type = '';
                /**
                 * @var {Number}
                 */
                this.worldId = 0;
                /**
                 * @var {Number}
                 */
                this.facilityId = 0;
                /**
                 * @var {Boolean}
                 */
                this.running = false;
                /**
                 * @var {Number|Null}
                 */
                this.controllingFaction = null;
                /**
                 * @var {Number|Null}
                 */
                this.attackingFaction = null;
                /**
                 * @var {Number|Null}
                 */
                this.capturablePoints = 0;
                /**
                 * @var {String}
                 */
                this.name = ''; // string
                /**
                 * @var {*}
                 */
                this.controlledPoints = {
                    "1": 0, // VS
                    "2": 0, // NC
                    "3": 0 // TR
                };
                /**
                 * @var {Boolean}
                 */
                this.init = true; // bool
            }

            describe(){
                let str = "<hr>"+this.name+"\n";
                str += "VS got "+this.controlledPoints["1"]+"/"+this.capturablePoints+" points\n";
                str += "NC got "+this.controlledPoints["2"]+"/"+this.capturablePoints+" points\n";
                str += "Attacking faction "+this.attackingFaction+", defending "+this.controllingFaction+"\n";
                return str;
            }
        }

        // peris amp, peris eastern,

        const facilityStack = [3400,3430,5700];
        const url = "ws://127.0.0.1:4568";
        const ws = new WebSocket(url+"/lanesmash");
        ws.onopen = () => {
            ws.send(JSON.stringify({
                subscribe: {
                    facilities: facilityStack,
                    startBases: {
                        1: 3400,
                        2: 5700
                    }
                }
            }));
        };

        ws.onmessage = (message) => {
            const payload = JSON.parse(message.data);
            if(payload && payload.type === 'LaneFacilityState'){
                const state = new LaneFacilityState();
                Object.assign(state,payload);
                container.innerHTML += state.describe();
            }
            else{
                console.log(payload);
            }
        }
        ws.onclose = () => {
            console.log("ded game");
        }

    });

</script>

</body>
</html>
